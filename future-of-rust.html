<!DOCTYPE html>
<html>

<head>
    <!-- Meta -->
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="generator" content="Jekyll">

    <title>The future of Rust</title>
  <meta name="description" content="Antoyo's Personal Blog">

    <!-- CSS & fonts -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/asciidoc-pygments.css">

    <!-- RSS -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/png" href="img/favicon.png">

</head>


<body>
    <div id="wrap">

        <!-- Navigation -->
        <nav id="nav">
    <div id="nav-list">
        <a href="/">Home</a>

        <!-- Nav pages -->
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      

    <!-- Nav links -->
      <a href="https://www.patreon.com/antoyo"><img class="patreon" src="https://c5.patreon.com/external/logo/become_a_patron_button.png"/></a>
<a class="btn sponsor" aria-label="Sponsor @antoyo" href="https://github.com/sponsors/antoyo">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="m8 14.25.345.666a.75.75 0 0 1-.69 0l-.008-.004-.018-.01a7.152 7.152 0 0 1-.31-.17 22.055 22.055 0 0 1-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.066 22.066 0 0 1-3.744 2.584l-.018.01-.006.003h-.002ZM4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.58 20.58 0 0 0 8 13.393a20.58 20.58 0 0 0 3.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.749.749 0 0 1-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5Z"></path>
  </svg>
  <span>Sponsor me</span>
</a>
<a class="btn" href="https://github.com/antoyo">Github</a>


    </div>

  <!-- Nav footer -->
    
      <footer>

    <span>version 1.0.0</span>

</footer>

    

</nav>


    <!-- Icon menu -->
      <a id="nav-menu">
        <div id="menu"></div>
      </a>

      <!-- Header -->
      
        <header id="header" class="parent justify-spaceBetween">
  <div class="inner w100 relative">
    <span class="f-left">
      <a href="/">
        <h1>
            Antoyo's Blog
        </h1>
      </a>
    </span>
    <span id="nav-links" class="absolute right bottom">
      <!-- Nav pages -->
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        

      <!-- Nav links -->
        <a href="https://www.patreon.com/antoyo"><img class="patreon" src="https://c5.patreon.com/external/logo/become_a_patron_button.png"/></a>
<a class="btn sponsor" aria-label="Sponsor @antoyo" href="https://github.com/sponsors/antoyo">
  <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
    <path d="m8 14.25.345.666a.75.75 0 0 1-.69 0l-.008-.004-.018-.01a7.152 7.152 0 0 1-.31-.17 22.055 22.055 0 0 1-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.066 22.066 0 0 1-3.744 2.584l-.018.01-.006.003h-.002ZM4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.58 20.58 0 0 0 8 13.393a20.58 20.58 0 0 0 3.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.749.749 0 0 1-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5Z"></path>
  </svg>
  <span>Sponsor me</span>
</a>
<a class="btn" href="https://github.com/antoyo">Github</a>


    </span>
  </div>
</header>




      

    <!-- Main content -->
      <div id="container">

        <main>

            <article id="post-page">
    <h2>The future of Rust</h2>
    <time datetime="2019-04-01T00:00:00+00:00" class="by-line">01 Apr 2019</time>
    <div class="content">

        <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>We had many meetings during the past months to
talk about the future of Rust.
It&#8217;s time to think about Rust 2.0 and how it will keep the many
advantages of the language, without its drawbacks.</p>
</div>
<div class="paragraph">
<p>First of all, we wanted to thank you for your contributions, your
comments and your support. We really appreciate the time you spend to
make this language the best language of the world.</p>
</div>
<div class="paragraph">
<p>Of course, we cannot please everybody and we had to take difficult
decisions to make the language better and ensure its future as the
fastest and safest programming language.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the_crate_ecosystem">The crate ecosystem</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One big advantage of Rust is its ecosystem of crates. It&#8217;s easy to
create new ones and to share them with everybody and there are many,
many crates that we can easily use in our projects.
This big advantage is also one of its greatest drawbacks:
by having so many crates, it&#8217;s very hard to find the one that are of
good quality.</p>
</div>
<div class="paragraph">
<p>So how can one attest the qualify of a library?
There&#8217;s only one way to do so: by reading its source code.
By doing so, not only one can see how many unsafe code, tests and
documentation there are in the library, but one can also see if the
crate is too complex for its own good:
if you do not feel comfortable to contribute or maintain a crate
you&#8217;re evaluating, it might not be a good idea to use it. Too much
complexity is usually a bad sign.
Take for example serde: we decided to deprecate rustc-serialize in
favor of serde because it provides so many new features. However,
serde grew into a very complex crate. Please read the source code of
both crates and you&#8217;ll quickly see what we mean.
To fix this, we&#8217;ll simplify serde as much as we can so that it&#8217;s code
become easy to read and maintain, while retaining all of its features,
of course.</p>
</div>
<div class="paragraph">
<p>Another very useful and nice crate that we work on is tokio. Again, it
started very simple and became highly complex.
We tried many approaches for tokio, but many users are still having
trouble to use it because it&#8217;s not so simple and the error messages
can be very confusing.
We thought a long time about this issue and we experimented with
another approach that is already successful in a language that has a
reference system somewhat similar to Rust: <a href="https://www.ponylang.io/">Pony</a>.
Instead of using async/await, it will be a very simple model with <a href="https://stdlib.ponylang.org/net-TCPConnectionNotify/">some</a>
<a href="https://stdlib.ponylang.org/net-TCPListenNotify/">interfaces</a> and an actor system.
We&#8217;re confident this will result in a system that is easy to use and
that you&#8217;ll be able to understand its source code fairly easily.</p>
</div>
<div class="paragraph">
<p>Another interesting metric to attest the quality of a crate is its
number of dependencies.
Since it&#8217;s so easy to add a new crate to our project, we tend to
include too much dependencies in our own project.
But that&#8217;s not always a good idea.
Why is that?
Well, remember: to evaluate a crate, you must read its source code. If
a crate has 100 transitive dependencies, will you really read the
source code of these 100 crates? Surely not!
There&#8217;s much more risk of bugs and the compilation time will be
exponentially longer (we&#8217;ll talk about this issue later).
That&#8217;s why we&#8217;ll start a new initiative: Remove Its Inessential Rust.
We&#8217;ll help people evaluate which dependencies they can remove from
their own crate.</p>
</div>
<div class="paragraph">
<p>To help people further in choosing a crate, we&#8217;ll be using the tool
<a href="https://github.com/dpc/crev/tree/master/cargo-crev">crev</a> and do code
reviews of the most popular crate.
We won&#8217;t write in our reviews things like:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is the crate well documented?</p>
</li>
<li>
<p>is it well tested?</p>
</li>
<li>
<p>does it contain too much unsafe code?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Because our resources are limited and because other people can easily
write such reviews, we&#8217;ll mostly focus of what we consider the most
important:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>is the code simple to understand?</p>
</li>
<li>
<p>does it contain useless dependencies?</p>
</li>
<li>
<p>is the crate useful at all?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The last point might seem weird, but some very popular crates do not
provide much features and since we want to reduce the number of
dependencies in our ecosystem, it makes sense to flag these crates in
order to reduce their usage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="language_simplifications">Language simplifications</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Over the years, we added many cool features in Rust, but this came at
a cost: the complexity of the language has increased dramatically.
For Rust 2.0, we decided to do a cleanup and remove some features that
makes the language more complex.</p>
</div>
<div class="paragraph">
<p>One feature we had a very hard time to decide to remove was the
procedural macros. It was a very hard choice because we&#8217;ve been
working very hard on them and it greatly enhanced meta-programming in
Rust.
But we had to face it: we were adding hacks over hacks to
make them produce good error messages and they deteriorate the
compilation time dramatically.
So, what will we have instead of them?
Well, once again, we were inspired by another language: <a href="https://ziglang.org/">Zig</a>.
In Zig, the power of constant functions is huge thanks to compile-time
reflection.
By replacing procedural macros by constant functions, plus
compile-time reflection and some useful directives like
<a href="https://ziglang.org/documentation/master/#export">this one</a>, we will
retain the power of procedural macros, but with less complexity.
We&#8217;re already working very hard on constant functions and we&#8217;ve
stabilized many of them recently. We&#8217;ll continue in this direction to
make this dream happen.</p>
</div>
<div class="paragraph">
<p>Another feature that we&#8217;ve added that have increased the complexity is
match ergonomics. We wanted to make the code simpler to write for
new users, but it turns out the error messages this feature can cause
are far from being easy to understand. And we cannot fix this since
the errors messages are bad because of the assumptions the compiler
makes about where to put <code>ref</code> or <code>mut</code>.
Match ergonomics was also the cause of <a href="https://blog.rust-lang.org/2018/06/05/Rust-1.26.2.html">some</a>
<a href="https://blog.rust-lang.org/2018/07/10/Rust-1.27.1.html">bugs</a> that made it to
stable Rust and that&#8217;s not something we can afford anymore.
That&#8217;s broken by design and
that&#8217;s why we&#8217;ll remove this feature in Rust 2.0.</p>
</div>
<div class="paragraph">
<p>We apologize for these changes: we really wanted to release these new
cool features quickly because we believed in them, but it turns out it
was a mistake.
In the future, we&#8217;ll take more time to experiment and gather feedback
from the users instead of rushing for stabilizing the features in the
language. That&#8217;s what is best for the future of the language.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="even_more_safety">Even more safety</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We won&#8217;t only remove features in the language: we&#8217;ll also add new
features.
We feel these new features are necessary because they will improve the
safety of the language.
Some time ago, a soundness bug was <a href="https://blog.rust-lang.org/2017/02/09/Rust-1.15.1.html">discovered</a>
in the standard library and we all know how unsafe code can be
dangerous.
Thus, we will add two new features that will help remove a lot of
unsafe code from the standard library and make it safer:
dependent types and stateful views.
Dependent types will help to prove that some invariants hold which
will greatly improve the safety of the code.</p>
</div>
<div class="paragraph">
<p>For instance, how many times have you created a <code>Some(value)</code> to
<code>unwrap()</code> it immediately after?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-s">&quot;string&quot;</span><span class="tok-p">);</span><span class="tok-w"></span>
<span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thanks to dependent types, this code will never fail at run-time
anymore: all the checks will be done at compile-time thanks to
dependent types.
The dependent <code>Option</code> type will be declared in a way similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">enum</span> <span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kt">bool</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-nb">Some</span><span class="tok-o">&lt;</span><span class="tok-kc">true</span><span class="tok-o">&gt;</span><span class="tok-p">(</span><span class="tok-n">T</span><span class="tok-p">),</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-nb">None</span><span class="tok-o">&lt;</span><span class="tok-kc">false</span><span class="tok-o">&gt;</span><span class="tok-p">(),</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These values, <code>true</code> and <code>false</code> will only exists at compile-time and
thus will not make using optional values slower: it will only make
them safer.
The <code>unwrap()</code> method will now be declared in a syntax similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-k">impl</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nb">Option</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-k">fn</span> <span class="tok-nf">unwrap</span><span class="tok-p">(</span><span class="tok-bp">self</span><span class="tok-p">)</span><span class="tok-w"> </span>-&gt; <span class="tok-nc">T</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-c1">// This is now valid since the pattern is</span>
<span class="tok-w">        </span><span class="tok-c1">// refutable thanks to dependent types.</span>
<span class="tok-w">        </span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-nb">Some</span><span class="tok-p">(</span><span class="tok-n">value</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-bp">self</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-n">value</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With this, code like the following will result in <strong>compile</strong>-time
error:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="rust"><span></span><span class="tok-kd">let</span><span class="tok-w"> </span><span class="tok-n">value</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nb">None</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-n">value</span><span class="tok-p">.</span><span class="tok-n">unwrap</span><span class="tok-p">();</span><span class="tok-w"></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, the <code>expect()</code> method will now become useless.</p>
</div>
<div class="paragraph">
<p><a href="https://www.cs.bu.edu/~hwxi/academic/papers/padl05.pdf">Stateful views</a>
will allow us to do safe pointer arithmetic which will
greatly reduce the usage of unsafe code in the standard library,
especially in the collections.
We encourage you to read the paper to learn more about it.</p>
</div>
<div class="paragraph">
<p>Hopefully, stateful views will mostly be hidden from most users like
unsafe code right now so that you will mostly remain unaffected by
them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="compiler_improvement">Compiler improvement</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As you might have seen <a href="https://vlang.io/compilation_speed">recently</a>,
the rust compiler is known to perform very poorly. We&#8217;ve been working
for a long time to improve this issue, but not enough.
Of course, removing some of the features we have just talked about
will help a great deal to improve the compile time, but we&#8217;ll do even
more:
it will be our priority to make Rust compile code faster than gcc and
we&#8217;ll do so by profiling and make it more parallel. It will become
blazingly fast: trust us.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We hope you&#8217;ll enjoy these changes. As always, we welcome your
feedback.</p>
</div>
</div>
</div>

    </div>
</article>



      </main>

          <!-- Pagination links -->
      

      </div>

        <!-- Footer -->
        <footer>
  <div class="footer">
    <a href="https://www.patreon.com/antoyo"><img class="patreon" src="https://c5.patreon.com/external/logo/become_a_patron_button.png"/></a>
    <a class="btn sponsor" aria-label="Sponsor @antoyo" href="https://github.com/sponsors/antoyo">
      <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true">
        <path d="m8 14.25.345.666a.75.75 0 0 1-.69 0l-.008-.004-.018-.01a7.152 7.152 0 0 1-.31-.17 22.055 22.055 0 0 1-3.434-2.414C2.045 10.731 0 8.35 0 5.5 0 2.836 2.086 1 4.25 1 5.797 1 7.153 1.802 8 3.02 8.847 1.802 10.203 1 11.75 1 13.914 1 16 2.836 16 5.5c0 2.85-2.045 5.231-3.885 6.818a22.066 22.066 0 0 1-3.744 2.584l-.018.01-.006.003h-.002ZM4.25 2.5c-1.336 0-2.75 1.164-2.75 3 0 2.15 1.58 4.144 3.365 5.682A20.58 20.58 0 0 0 8 13.393a20.58 20.58 0 0 0 3.135-2.211C12.92 9.644 14.5 7.65 14.5 5.5c0-1.836-1.414-3-2.75-3-1.373 0-2.609.986-3.029 2.456a.749.749 0 0 1-1.442 0C6.859 3.486 5.623 2.5 4.25 2.5Z"></path>
      </svg>
      <span>Sponsor me</span>
    </a>
  </div>
  <span>Â© 2017-2026 - Antoni Boucher</span>
</footer>


        <!-- Script -->
      <script src="/js/main.js"></script>


    </div>
</body>
</html>
